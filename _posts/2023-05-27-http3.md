---
layout: post
title: http - 3
subtitle: cookie, session, token
categories: TIL
tags: [TIL, HTTP]
---

## 쿠키, 세션, 토큰을 왜 쓰는가?

http는 stateless protocol이다. 즉 state를 저장하지 않는다는 것이다. 그렇다면 사용자가 로그인 되었다는 것과 사용자의 정보를 검색하는 등의 요청을 수행할 수 있을까? 바로 쿠키, 세션, 토큰을 이용해서 가능하다!

## 브라우저에 저장되는 정보 - 쿠키

쿠키는 크롬이나 사파리 같은 브라우저에 저장되는 작은 텍스트 조각입니다. 브라우저는 사용자의 컴퓨터에 설치된 소프트웨어이므로 쿠키는 사용자가 갖고 있는 정보라고 할 수 있습니다. 사용자는 브라우저의 설정 화면이나 개발자 도구에서 쿠키를 확인하고 수정, 삭제할 수 있습니다. 다만 쿠키는 당사자뿐만 아니라 제 3자가 조회하는 것도 가능하기 때문에 개인 정보를 담은 내용이나 보안상 민감한 정보를 저장하는 데에는 적합하지 않습니다. 따라서 혹여 남에게 탈취되거나 사용자에 의해 조작되어도 크게 문제되지 않을 정보를 브라우저에 저장함으로써 웹사이트 이용을 편리하게 해 주는 것이 쿠키입니다. 예를 들면 자주 보는 웹툰 목록이나 웹 페이지의 다크 모드 설정 여부 등과 같은 간단한 정보가 이에 해당합니다.

## 서버가 나를 알아보는 방법 - 세션

사용자의 로그인 상태를 유지하기 위해 쿠키에 아이디와 비밀번호를 담아 두고 있다고 생각해봅시다. 쿠키는 브라우저에 저장되는 정보이므로 공용 컴퓨터에서 로그인을 할 경우 사용자의 개인정보가 위험할 수 있습니다.
따라서 사용자가 사이트에 한 번 로그인하면 유효기간이 끝날 때까지 더 이상 아이디와 비밀번호를 입력하지 않아도 되도록 사용자가 이미 서버로부터 인증받았음을 증명해 주는 session이라는 증서가 필요합니다. 사용자가 서버에 올바른 아이디와 비밀번호로 로그인에 성공하면 서버는 session 아이디라는 데이터를 만듭니다. 보통은 ‘2sd98dbawix4’와 같은 식으로 알파벳과 숫자가 혼합된 형식을 갖고 있습니다. 서버는 영화관에서 티켓을 보관용 부분만 찢어 건네주듯 세션 아이디를 사용자에게 전달하고, 메모리에 아이디 사본을 어떤 사용자의 것인지 적어서 보관합니다.  
사용자는 서버로부터 받은 세션 아이디를 쿠키로 저장한 다음 앞으로의 모든 요청에 함께 전달합니다. 친구 목록을 볼 때, 댓글을 작성하거나 삭제할 때, 구매한 상품 내역을 볼 때도 서버에게 세션 아이디를 적은 편지를 보냅니다.

서버는 사용자에게서 친구 목록을 보겠다는 요청을 받으면 그 편지에 세션 아이디가 적혀있는지를 확인합니다. 아이디가 있다면 서버가 보관하고 있는 세션 아이디 중에 동일한 정보가 있는지 찾아보고 그것이 누구의 계정인지도 알아내죠. 그렇게 편지를 보낸 사람이 누구인지 파악한 다음 해당 사용자의 친구 목록을 보내주는 것입니다.

session은 서버에 인증 정보와 session ID를 저장하고 있기 때문에 사용자가 수백, 수천으로 늘어난다면 해당 유저의 정보를 찾고 데이터 매칭에 오랜 시간이 걸리면서 서버에 부하가 가해질 것입니다.

## 또 다른 로그인 유지 방식 - 토큰

메모리 공간을 많이 차지하는 세션 방식의 대안으로 로그인한 사용자에게 세션 아이디 대신 "token"을 발급해 주는 것이다. 이러한 token은 암호화가 되어 있어 서버만이 유효한 토큰을 발행 및 확인할 수 있다. 토큰을 받아간 사용자는 이를 쿠키로 저장해두고 필요할 때마다 제시하면 서버가 토큰이 유효한 토큰인지 아닌지 확인하는 방식이다.  
더이상 서버에 사용자의 정보 및 ID를 저장할 필요가 없기 때문에 서버 부하를 줄일 수 있다. 토큰 방식에도 한계가 있다. 여러 기기에서의 로그인을 제한하기 위해 필요한 때에 로그인되어 있는 사용자를 서버가 강제로 로그아웃을 시킬 수 있어야한다. 하지만 토큰 방식에서는 이것이 불가능하다. 한 번 발행된 토큰은 유효기간이 끝나기 전까지 따로 통제할 수 없기 때문에 세션에 비해 토큰 정보를 탈취 당할 가능성이 높다. 물론 토큰의 만료기간을 짧게 지정해 피해를 줄일 수 있다.

- Authentication: 로그인 과정(등록된 유저? && 아이디와 패스워드가 일치?)
- Authorization: 등록된 유저의 권한(permission)을 설정해주는 과정(각 서비스별 read/write/delete 가능여부 설정)

## 참고

블로그 - <a href="https://velog.io/@jung5318/%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90">쿠키, 세션, 토큰의 차이점</a>  
블로그 - <a href="https://hongong.hanbit.co.kr/%EC%99%84%EB%B2%BD-%EC%A0%95%EB%A6%AC-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0-%EC%BA%90%EC%8B%9C-%EA%B7%B8%EB%A6%AC%EA%B3%A0-cdn/">데이터를 저장하는 5가지 개념</a>
